Everything I know about the XZ backdoorEvan Boehs email  United States is lost in thoughtEverything I Know About the XZ Backdoorstateevergreeninblogtagsopen-sourcedate3/29/2024This publication was last updated at 12:49 PM EST on April 8thRecently, a backdoor¬†was discovered¬†in XZ, a popular library for lossless data compression. Initial research efforts were predominantly concentrated on unpacking the well-disguised attack vector, while the social aspects of the attack received only murmurings. To investigate this attack, I never read a line of code. Instead, I spent dozens of hours pouring over hundreds of discussion threads and mailing lists. I‚Äôve concluded that while the events that unfolded are undoubtedly a tragedy, it was one of our own making ‚Äî one of an ugly reality that quietly plays out every day. Our attacker was not na√Øve. They meticulously examined the culture of open source and then pounced on its norms, twisting them strategically to their benefit. If we continue to focus purely on technicalities, nothing will ever change. This story will play out time and time again, like it already has for decades. We must stop focusing on fuzzing and static analysis and instead¬†turn our attention to¬†the human costs of open source. We must learn. With this in mind, I present a timeline of the attack¬†‚Äî one¬†from a new perspective¬†that‚Äôs too often ignored.2021JiaT75 (Jia Tan) creates their GitHub account.The first commits they make are not to xz, but they are deeply suspicious. Specifically, they open a PR in libarchive: Added error text to warning when untaring with bsdtar. This commit does a little more than it says. It replaces safe_fprint with an unsafe variant, potentially introducing another vulnerability. The code was merged without any discussion, and lives on to this day (patched).2022In April 2022, Jia Tan submitted a patch via a mailing list. The contents of the patch are not relevant, but the events that follow are. A new persona ‚Äî Jigar Kumar ‚Äî enters, and begins pressuring for this patch to be merged.Soon after, Jigar Kumar begins pressuring Lasse Collin to add another maintainer to XZ. In the fallout, there is much to learn about mental health in open source.Three days after the emails pressuring Lasse Collin to add another maintainer, JiaT75 makes their first commit to xz: Tests: Created tests for hardware functions.. Since this commit, they become a regular contributor to xz (they are currently the second most active). It‚Äôs unclear exactly when they became trusted in this repository.Jigar Kumar is never seen again. Another account ‚Äî Dennis Ens also participates in pressure, with a similar name+number formatted email. This account is also never seen outside of xz discussion, and neither have any associated accounts that have been discovered.Glyph @glyph@mastodon.social@eb I really hope that this causes an industry-wide reckoning with the common practice of letting your entire goddamn product rest on the shoulders of one overworked person having a slow mental health crisis without financially or operationally supporting them whatsoever. I want everyone who has an open source dependency to read this message https://www.mail-archive.com/xz-devel@tukaani.org/msg00567.htmlMar 29, 2024, 20:43 558 retoots2023JiaT75 merges their first commit on Jan 7, 20231, which gives us a good indication of when they fully gain trust.In March, the primary contact email in Google‚Äôs oss-fuzz is updated to be Jia‚Äôs, instead of Lasse Collin.Testing infrastructure that will be used in this exploit is committed. Despite Lasse Collin being attributed as the author for this, Jia Tan committed it, and it was originally written by Hans Jansen in June:Commit: liblzma: Add ifunc implementation to crc64_fast.cPR: Replaced crc64_fast constructor with ifunc by hansjans162Hans Jansen‚Äôs account was seemingly made specifically to create this pull request. There is very little activity before and after. They will later push for the compromised version of XZ to be included in Debian.In July, a PR was opened in oss-fuzz to disable ifunc for fuzzing builds, due to issues introduced by the changes above. This appears to be deliberate to mask the malicious changes that will be introduced soon. Also, JiaT75 opened an issue about a warning in clang that, while indeed incorrect, drew attention to ifuncs.2024A pull request for Google‚Äôs oss-fuzz is opened that changes the URL for the project from tukaani.org/xz/ to xz.tukaani.org/xz-utils/. tukaani.org is hosted at 5.44.245.25 in Finland, at this hosting company. The xz subdomain, meanwhile, points to GitHub pages. This furthers the amount of control Jia has over the project.A commit containing the final steps required to execute this backdoor is added to the repository:Tests: Add a few test filesTests: Update two test filesThe discoveryAn email is sent to the oss-security mailing list: backdoor in upstream xz/liblzma leading to ssh server compromise, announcing this discovery, and doing it‚Äôs best to explain the exploit chain.AndresFreundTec @AndresFreundTec@mastodon.socialI was doing some micro-benchmarking at the time, needed to quiesce the system to reduce noise. Saw sshd processes were using a surprising amount of CPU, despite immediately failing because of wrong usernames etc. Profiled sshd, showing lots of cpu time in liblzma, with perf unable to attribute it to a symbol. Got suspicious. Recalled that I had seen an odd valgrind complaint in automated testing of postgres, a few weeks earlier, after package updates.Really required a lot of coincidences.Mar 29, 2024, 18:32 791 retootsA gist has been published with a great high-level technical overview and a ‚Äúwhat you need to know‚ÄùIn addition to the gist and the email above, several analysis attempts have begun emerging:xz/liblzma: Bash-stage Obfuscation Explained‚ÄúIt‚Äôs RCE, not auth bypass‚Äù[WIP] XZ Backdoor Analysis and symbol mappingInfographicxzbot: notes, honeypot, and exploit demo for the xz backdoorresearch!rsc: The xz attack shell scriptA sudden push for inclusionA request for the vulnerable version to be included in Debian is opened by Hans:#1067708 - xz-utils: New upstream version availableThis request was opened the same week Hans‚Äô Debian GitLab account was created. The account created a few similar ‚Äúupdate‚Äù requests in various low-traffic repositories to build credibility, after asking for this one.Several other, suspicious, anonymous name+number accounts with little former activity also push for its inclusion, including misoeater91 and krygorin4545. krygorin4545‚Äôs PGP key was made 2 days before joining the discussion.Also seeing this bug. Extra valgrind output causes some failed tests for me. Looks like the new version will resolve it. Would like this new version so I can continue work.I noticed this last week and almost made a Valgrind bug. Glad to see it being fixed.Thanks Hans!The Valgrind bugs mentioned were introduced by this malicious injection, as noted in the email to OSS-Security:Subsequently the injected code (more about that below) caused valgrind errors and crashes in some configurations, due to the stack layout differing from what the backdoor was expecting. These issues were attempted to be worked around in 5.6.1:A pull request to a go library by a 1Password employee is opened asking to upgrade the library to the vulnerable version, however, it was all unfortunate timing. 1Password reached out by email referring me to this comment, and everything seems to check out.A Fedora contributor states that Jia was pushing for its inclusion in Fedora as it contains ‚Äúgreat new features‚ÄùJia Tan also attempted to get it into Ubuntu days before the beta freeze.A few hours after all this came out, GitHub suspended JiaT75‚Äôs account. Thanks? They also banned the repository, meaning people can no longer audit the changes made to it without resorting to mirrors. Immensely helpful, GitHub. They also suspended Lasse Collin‚Äôs account, which is completely disgraceful.Lasse has begun reverting changes introduced by Jia, including one that added a sneaky period to disable the sandbox. They also have published a FAQ that begins to explain the situation: XZ Utils backdoorOSINTVarious people have reached out to me regarding discoveries about the identity of Jia. Some of this has been incorporated in the timeline, but other stuff is ‚Äútimeless‚Äù so I‚Äôm putting it here:IRCI received an email that clarified a few points and provided new insight into the situation.‚ÄúJia Tan‚Äù was present on the #tukaani IRC channel on Libera.Chat. A /whois revealed their connecting IP and activity on March 29th.[libera] -!- jiatan [~jiatan@185.128.24.163]
[libera] -!-  was      : Jia Tan
[libera] -!-  hostname : 185.128.24.163
[libera] -!-  account  : jiatan
[libera] -!-  server   : tungsten.libera.chat [Fri Mar 29 14:47:40 2024]
[libera] -!- End of WHOWASRunning a Nmap on the IP shows a lot of open ports, which probably indicates a proxy, hosting provider, or something of the sort. The IP is from Singapore.Further research shows that this IP belongs to Witopia VPN, so it‚Äôs not entirely indicative of a region. Given the timezone, however, I feel like proximity becomes plausible.Important notes on LinkedInI have received a few emails alerting me to a LinkedIn of somebody named Jia Tan2. Their bio boasts of large-scale vulnerability management. They claim to live in California. Is this our man? The commits on JiaT75‚Äôs GitHub are set to +0800, which would not indicate presence in California. UTC-0800 would be California. Most of the commits were made between UTC 12-17, which is awfully early for California. In my opinion, there is no sufficient evidence that the LinkedIn being discussed is our man. I think identity theft is more likely, but I am of course open to more evidence.Apr 7 Update: Subsequently, I‚Äôve received a lot of people sending me other LinkedIn accounts, theorizing about what his name could mean, etc., but I don‚Äôt think a bad actor would use their real name.Discoveries in the Git logsI received an email from Minhu Wang who investigated the Git log, and found one instance where Jia‚Äôs username was different:$ git shortlog --summary --numbered --email | grep jiat0218@gmail.com
273 Jia Tan <jiat0218@gmail.com>
2 jiat75 <jiat0218@gmail.com>
1 Jia Cheong Tan <jiat0218@gmail.com>They found this particularly interesting as Cheong is new informationFurthermore, an independent analysis of commit timings concludes that the perpetrator worked ‚ÄúOffice Hours‚Äù in a UTC+02/03 timezone. It‚Äôs particularly notable that they worked through the Lunar New Year, and did not work on some notable Eastern European holidays, including Christmas and New Year. I have, however, been presented with a differing view, which you can read here.Ry Jones used gharchive to extract Jia‚Äôs entire git activity, and he uploaded it to a repository, viewable here: jiat75-logs. Jia‚Äôs GitHub username previously featured Cheong, but this has since been removed.üëü FootnotesThanks @joeyh@hachyderm.io ‚Ü©Ô∏éI was also alerted to discussions of this on Gab, which should tell you what you need to know. ‚Ü©Ô∏éüå± What links here?Bountysource Stole at Least $21,000 From Open Source DevelopersEvan Boehs /node/everything-i-know-about-the-xz-backdoor








        _____,....-----'------'-----''-------'---'----'--MainHomeContactBlogLinksGitHubMastodon (Bsky)Donate (Ko-fi)Meta‚§∫ üï∏üíç ‚§ªBlogrollAnalytics




What we know about the xz Utils backdoor that almost infected the world - Ars Technica













































































  Skip to content








Ars Technica home









            Sections
            







                Forum
              


                  Subscribe
                









                    AI
                  




                    Biz & IT
                  




                    Cars
                  




                    Culture
                  




                    Gaming
                  




                    Health
                  




                    Policy
                  




                    Science
                  




                    Security
                  




                    Space
                  




                    Tech
                  







                  Feature
                




                  Reviews
                




                  Store
                









            AI
          



            Biz & IT
          



            Cars
          



            Culture
          



            Gaming
          



            Health
          



            Policy
          



            Science
          



            Security
          



            Space
          



            Tech
          



      Forum
    


        Subscribe
      












Story text


Size

Small
Standard
Large

Width
      *


Standard
Wide

Links

Standard
Orange


* Subscribers only
      Learn more


            Pin to story
          










Theme










                HyperLight
              


                Day & Night
              


                Dark
              


                System
              














    Sign In
  















    NIGHTMARE SUPPLY CHAIN ATTACK SCENARIO
  



      What we know about the xz Utils backdoor that almost infected the world
    

      Malicious updates made to a ubiquitous tool were a few weeks away from going mainstream.
    


    Dan Goodin
  
–


    Apr 1, 2024 2:55 am
  
| 

    210
  













          Credit:

          
          Getty Images

                  











          Credit:

          
          Getty Images

                  












Text
        settings













Story text






Size

Small
Standard
Large

Width
      *


Standard
Wide

Links

Standard
Orange


* Subscribers only
      Learn more


            Minimize to nav
          










On Friday, a lone Microsoft developer rocked the world when he revealed a backdoor had been intentionally planted in xz Utils, an open source data compression utility available on almost all installations of Linux and other Unix-like operating systems. The person or people behind this project likely spent years on it. They were likely very close to seeing the backdoor update merged into Debian and Red Hat, the two biggest distributions of Linux, when an eagle-eyed software developer spotted something fishy.
"This might be the best executed supply chain attack we've seen described in the open, and it's a nightmare scenario: malicious, competent, authorized upstream in a widely used library," software and cryptography engineer Filippo Valsorda said of the effort, which came frightfully close to succeeding.
Researchers have spent the weekend gathering clues. Here's what we know so far.
What is xz Utils?
xz Utils is nearly ubiquitous in Linux. It provides lossless data compression on virtually all Unix-like operating systems, including Linux. xz Utils provides critical functions for compressing and decompressing data during all kinds of operations. xz Utils also supports the legacy .lzma format, making this component even more crucial.
What happened?
Andres Freund, a developer and engineer working on Microsoft’s PostgreSQL offerings, was recently troubleshooting performance problems a Debian system was experiencing with SSH, the most widely used protocol for remotely logging in to devices over the Internet. Specifically, SSH logins were consuming too many CPU cycles and were generating errors with valgrind, a utility for monitoring computer memory.
Through sheer luck and Freund’s careful eye, he eventually discovered the problems were the result of updates that had been made to xz Utils. On Friday, Freund took to the Open Source Security List to disclose the updates were the result of someone intentionally planting a backdoor in the compression software.
It's hard to overstate the complexity of the social engineering and the inner workings of the backdoor. Thomas Roccia, a researcher at Microsoft, published a graphic on Mastodon that helps visualize the sprawling extent of the nearly successful endeavor to spread a backdoor with a reach that would have dwarfed the SolarWinds event from 2020.


































What does the backdoor do?
Malicious code added to xz Utils versions 5.6.0 and 5.6.1 modified the way the software functions. The backdoor manipulated sshd, the executable file used to make remote SSH connections. Anyone in possession of a predetermined encryption key could stash any code of their choice in an SSH login certificate, upload it, and execute it on the backdoored device. No one has actually seen code uploaded, so it's not known what code the attacker planned to run. In theory, the code could allow for just about anything, including stealing encryption keys or installing malware.
Wait, how can a compression utility manipulate a process as security sensitive as SSH?
Any library can tamper with the inner workings of any executable it is linked against. Often, the developer of the executable will establish a link to a library that's needed for it to work properly. OpenSSH, the most popular sshd implementation, doesn’t link the liblzma library, but Debian and many other Linux distributions add a patch to link sshd to systemd, a program that loads a variety of services during the system bootup. Systemd, in turn, links to liblzma, and this allows xz Utils to exert control over sshd.
How did this backdoor come to be?
It would appear that this backdoor was years in the making. In 2021, someone with the username JiaT75 made their first known commit to an open source project. In retrospect, the change to the libarchive project is suspicious, because it replaced the safe_fprint funcion with a variant that has long been recognized as less secure. No one noticed at the time.
The following year, JiaT75 submitted a patch over the xz Utils mailing list, and, almost immediately, a never-before-seen participant named Jigar Kumar joined the discussion and argued that Lasse Collin, the longtime maintainer of xz Utils, hadn’t been updating the software often or fast enough. Kumar, with the support of Dennis Ens and several other people who had never had a presence on the list, pressured Collin to bring on an additional developer to maintain the project.



















In January 2023, JiaT75 made their first commit to xz Utils. In the months following, JiaT75, who used the name Jia Tan, became increasingly involved in xz Utils affairs. For instance, Tan replaced Collins' contact information with their own on oss-fuzz, a project that scans open source software for vulnerabilities that can be exploited. Tan also requested that oss-fuzz disable the ifunc function during testing, a change that prevented it from detecting the malicious changes Tan would soon make to xz Utils.
In February of this year, Tan issued commits for versions 5.6.0 and 5.6.1 of xz Utils. The updates implemented the backdoor. In the following weeks, Tan or others appealed to developers of Ubuntu, Red Hat, and Debian to merge the updates into their OSes. Eventually, one of the two updates made its way into the following releases, according to security firm Tenable:




Distribution
Advisory
Notes




Fedora Rawhide
https://www.redhat.com/en/blog/urgent-security-alert-fedora-41-and-rawhide-users
Fedora Rawhide is the development distribution of Fedora Linux


Fedora 41
https://www.redhat.com/en/blog/urgent-security-alert-fedora-41-and-rawhide-users



Debian testing, unstable and experimental distributions versions 5.5.1alpha-0.1 to 5.6.1-1.
https://lists.debian.org/debian-security-announce/2024/msg00057.html



openSUSE Tumbleweed and openSUSE MicroOS
https://news.opensuse.org/2024/03/29/xz-backdoor/
Backdoored version of xz was included in Tumbleweed and MicroOS between March 7 and March 28


Kali Linux
https://www.kali.org/blog/about-the-xz-backdoor/
Backdoored version of xz was included in Kali Linux (xz-utils 5.6.0-0.2) between March 26 and March 28




There’s more about Tan and the timeline here.

Can you say more about what this backdoor does?
In a nutshell, it allows someone with the right private key to hijack sshd, the executable file responsible for making SSH connections, and from there to execute malicious commands. The backdoor is implemented through a five-stage loader that uses a series of simple but clever techniques to hide itself. It also provides the means for new payloads to be delivered without major changes being required.
Multiple people who have reverse-engineered the updates have much more to say about the backdoor.
Developer Sam James provided this overview:
This backdoor has several components. At a high level:

The release tarballs upstream publishes don't have the same code that GitHub has. This is common in C projects so that downstream consumers don't need to remember how to run autotools and autoconf. The version of build-to-host.m4 in the release tarballs differs wildly from the upstream on GitHub.
There are crafted test files in the tests/ folder within the git repository too. These files are in the following commits:

tests/files/bad-3-corrupt_lzma2.xz (cf44e4b7f5dfdbf8c78aef377c10f71e274f63c0, 74b138d2a6529f2c07729d7c77b1725a8e8b16f1)
tests/files/good-large_compressed.lzma (cf44e4b7f5dfdbf8c78aef377c10f71e274f63c0, 74b138d2a6529f2c07729d7c77b1725a8e8b16f1)


A script called by build-to-host.m4 unpacks this malicious test data and uses it to modify the build process.
IFUNC, a mechanism in glibc that allows for indirect function calls, is used to perform runtime hooking/redirection of OpenSSH's authentication routines. IFUNC is a tool that is normally used for legitimate things, but in this case it is exploited for this attack path.

Normally, upstream publishes release tarballs that are different than the automatically generated ones in GitHub. In these modified tarballs, a malicious version of build-to-host.m4 is included to execute a script during the build process.
This script (at least in versions 5.6.0 and 5.6.1) checks for various conditions like the architecture of the machine. Here is a snippet of the malicious script that gets unpacked by build-to-host.m4 and an explanation of what it does:
if ! (echo "$build" | grep -Eq "^x86_64" > /dev/null 2>&1) && (echo "$build" | grep -Eq "linux-gnu$" > /dev/null 2>&1);then

If amd64/x86_64 is the target of the build
And if the target uses the name linux-gnu (mostly checks for the use of glibc)

It also checks for the toolchain being used:
if test "x$GCC" != 'xyes' > /dev/null 2>&1;then
exit 0
fi
if test "x$CC" != 'xgcc' > /dev/null 2>&1;then
exit 0
fi
LDv=$LD" -v"
if ! $LDv 2>&1 | grep -qs 'GNU ld' > /dev/null 2>&1;then
exit 0
And if you are trying to build a Debian or Red Hat package:
if test -f "$srcdir/debian/rules" || test "x$RPM_ARCH" = "xx86_64";then
This attack thusly seems to be targeted at amd64 systems running glibc using either Debian or Red Hat derived distributions. Other systems may be vulnerable at this time, but we don't know.
In an online interview, developer and reverse-engineer HD Moore confirmed the Sam James suspicion that the backdoor targeted either Debian or Red Hat distributions.



















“The attack was sneaky in that it only did the final steps of the backdoor if you were building the library on amd64 (intel x86 64-bit) and were building a Debian or a RPM package (instead of using it for a local installation),” he wrote.
Paraphrasing observations from researchers who collectively spent the weekend analyzing the malicious updates, he continued:
When verifying an SSH public key, if the public key matches a certain fingerprint function, the key contents are decrypted using a pre-shared key before the public key is actually verified. The decrypted contents are then passed directly to system.
If the fingerprint doesn't match or the decrypted contents don't match a certain format, it falls back to regular key verification and no-one's the wiser.
The backdoor is super sneaky. It uses a little-known feature of the glibc to hook a function. It only triggers when the backdoored xz library gets loaded by a /usr/bin/sshd process on one of the affected distributions. There may be many other backdoors, but the one everyone is talking about uses the function indirection stuff to add the hook. The payload was encoded into fake xz test files and runs as a shellcode effectively, changing the SSH RSA key verification code so that a magic public key (sent during normal authentication) let the attacker gain access
​​Their grand scheme was:
1) sneakily backdoor the release tarballs, but not the source code
2) use sockpuppet accounts to convince the various Linux distributions to pull the latest version and package it
3) once those distributions shipped it, they could take over any downstream user/company system/etc
Researchers from networking firm Akamai also explain well how the backdoor works:

The backdoor is quite complex. For starters, you won’t find it in the xz GitHub repository (which is currently disabled, but that’s besides the point). In what seems like an attempt to avoid detection, instead of pushing parts of the backdoor to the public git repository, the malicious maintainer only included it in source code tarball releases. This caused parts of the backdoor to remain relatively hidden, while still being used during the build process of dependent projects.
The backdoor is composed of many parts introduced over multiple commits:

Using IFUNCs in the build process, which will be used to hijack the symbol resolve functions by the malware
Including an obfuscated shared object hidden in test files
Running a script set during the build process of the library that extracts the shared object (not included in the repository, only in releases, but added to .gitignore)
Disabling landlocking, which is a security feature to restrict process privileges

The execution chain also consists of multiple stages:

The malicious script build-to-host.m4 is run during the library’s build process and decodes the “test” file bad-3-corrupt_lzma2.xz into a bash script
The bash script then performs a more complicated decode process on another “test” file, good-large_compressed.lzma, decoding it into another script
That script then extracts a shared object liblzma_la-crc64-fast.o, which is added to the compilation process of liblzma

This process is admittedly hard to follow. We recommend Thomas Roccia’s infographic for a great visual reference and in-depth analysis.
The shared object itself is compiled into liblzma, and replaces the regular function name resolution process. During (any) process loading, function names are resolved into actual pointers to the process memory, pointing at the binary code. The malicious library interferes with the function resolving process, so it could replace the function pointer for the OpenSSH function RSA_public_decrypt (Figure 1).
It then points that function to a malicious one of its own, which according to research published by Filippo Valsorda, extracts a command from the authenticating client’s certificate (after verifying that it is the threat actor) and passes it on to the system() function for execution, thereby achieving RCE prior to authentication.








                The liblzma hooking process
                                  
                    Credit:
                                          Akamai
                                      








      The liblzma hooking process

              
          Credit:

          
          Akamai

                  





What more do we know about Jia Tan?



















At the moment, extremely little, especially for someone entrusted to steward a piece of software as ubiquitous and as sensitive as xz Utils. This developer persona has touched dozens of other pieces of open source software in the past few years. At the moment, it’s unknown if there was ever a real-world person behind this username or if Jia Tan is a completely fabricated individual.
Additional technical analysis is available from the above Bluesky thread from Valsorda, researcher Kevin Beaumont, and Freund’s Friday disclosure.
Is there a CVE tracking designation?
Yes, it's CVE-2024-3094.
How do I know if the backdoor is present on my device?
There are several ways. One is this page from security firm Binarly. The tool detects implementation of IFUNC and is based on behavioral analysis. It can automatically detect invariants in the event a similar backdoor is implanted elsewhere.
There's also a project called xzbot. It provides the following:

honeypot: fake vulnerable server to detect exploit attempts
ed448 patch: patch liblzma.so to use our own ED448 public key
backdoor format: format of the backdoor payload
backdoor demo: cli to trigger the RCE assuming knowledge of the ED448 private key






Related Stories











            Backdoor found in widely used Linux utility targets encrypted SSH connections
          

            Malicious code planted in xz Utils has been circulating for more than a month.
          










    Listing image:
    Getty Images
  






Dan Goodin
Senior Security Editor




Dan Goodin
Senior Security Editor


      Dan Goodin is Senior Security Editor at Ars Technica, where he oversees coverage of malware, computer espionage, botnets, hardware hacking, encryption, and passwords. In his spare time, he enjoys gardening, cooking, and following the independent music scene. Dan is based in San Francisco. Follow him at here on Mastodon and here on Bluesky. Contact him on Signal at DanArs.82.
    






    210 Comments
  


















Staff Picks




C

Christarp



            The whole world got lucky that one developer was determined enough to discover the cause of a minor performance regression. Just makes you wonder what else hasn't yet been discovered in our open source tooling out there.

Really eye opening, thank you Andres!

Edit: And of course, Dan for the wonderful article.
          


April 1, 2024 at 7:16 am





B

BarnSoftEng



It should be noted that the attack only works because Debian and Redhat added functionality to sshd that is not present in it as distributed by its developers. The extra functionality adds systemd interaction, which requires libsystemd which requires liblzma, a component of the (compromised) xz package.

One should be wary of distributions adding functionality. Often it increases the attack surface, not only because of the modifications/additions themselves, but also by adding dependencies.This conclusion ignores the huge value that the patches that all OS apply to packages provides. Without patches much upstream software will not build, will not run correctly.
          


April 1, 2024 at 7:49 am





p

pseudonomous



It should be noted that the attack only works because Debian and Redhat added functionality to sshd that is not present in it as distributed by its developers. The extra functionality adds systemd interaction, which requires libsystemd which requires liblzma, a component of the (compromised) xz package.

One should be wary of distributions adding functionality. Often it increases the attack surface, not only because of the modifications/additions themselves, but also by adding dependencies.
While this is true, to a degree, it's also quite possible that if there were a lot of interesting targets out there that didn't patch sshd to use systemd and libxz, that given the level of access they had, the actor here could almost certainly found some other way to put an obfuscated backdoor into the code.

I mean, certainly the OpenSSH project is obviously in the clear, but having gained commit access to a critical library, I don't think we could feel safe that "Jia Tan" couldn't have constructed a different backdoor even if they couldn't use the particular behavior Debian and Ubuntu added to their version of SSH.

And I'm not sure anybody feels totally safe until somebody audits the code to make sure there's nothing else lurking in here that might be dangerous.
          


April 1, 2024 at 7:50 am





B

BarnSoftEng



So a prime reason this became potentially exploitable is libsystemd in OpenSSH. Need I say more.The prime reason is a very well funded and capable attacker looked for a way in.
if not xz or systemd then they would have attacked via the next candidate weak point.
          


April 1, 2024 at 7:51 am





o

om1



The prime reason is a very well funded and capable attacker looked for a way in.
if not xz or systemd then they would have attacked via the next candidate weak point.I do know that the OpenSSH devs are very strict on not increasing attack surface. The main reason why they did not want to link to systemd in the distributed version. You can be sure that OpenSSH as distributed contains less opportunity for attackers than the modified versions. That's my main point: modifications by distributions are not always improvements.
          


April 1, 2024 at 8:20 am







MikeGale



            We are lucky that this was detected and that some competent people have moved in to analyse. I presume more analysis is still being done. (Thanks to them.)

What we don't know is how many other similar attacks have been deployed, and how many are in preparation.

What can decent people do to reduce our risks?

Thoughts that come to mind:
1.  Some of those who do this, often thankless, maintenance work might like more support.  This might be financial contributions, or people (who know what they're doing) reviewing code submissions.  Those who incorporate these libraries into their own programs (and all users) should maybe think about this.  If there were a "donate to the maintainers" button on a story like this, that would convert the immediate story into something of greater value, if the maintainer would like that.
2.  Some of the maintainers might appreciate recognition.  Some won't, but worth considering.
3.  Some who use the libraries can improve the checking they do.
4.  Unpleasant people who harass maintainers should be detected and treated appropriately.
          


April 1, 2024 at 9:17 am





T

TheMongoose



"This developer persona has touched dozens of other pieces of open-source software in the past few years.". Well, I guess the Opensource community have some codes to review. Maybe the xz incident is only the tips of the iceberg.Right? I didn’t realise until I read this article just how far back this started. Now you’ve got to wonder: if this was a group, how  many other so-far benign identities they have, contributing good code and building up reputations. And how easy it would be for them to slip a little something into another fundamental tool.
          


April 1, 2024 at 9:18 am












    Comments
  


Forum view






      Loading comments...
    





















Prev story


Next story












        Most Read










1.
Florida man eats diet of butter, cheese, beef; cholesterol oozes from his body








2.
NASA moves swiftly to end DEI programs, ask employees to “report” violations








3.
Reddit won’t interfere with users revolting against X with subreddit bans








4.
Trump admin fires security board investigating Chinese hack of large ISPs








5.
All the things Nintendo didn’t tell us about the Switch 2








Customize




















Ars Technica has been separating the signal from
          the noise for over 25 years. With our unique combination of
          technical savvy and wide-ranging interest in the technological arts
          and sciences, Ars is the trusted source in a sea of information. After
          all, you don’t need to know everything, only what’s important.



















More
          from Ars
        
About Us
Staff Directory
Newsletters
Ars Videos
General FAQ
RSS Feeds



Contact
Contact us
Advertise with us
Reprints






Do Not Sell My Personal
            Information

      
      © 2025 Condé Nast. All rights reserved. Use of and/or
      registration on any portion of this site constitutes acceptance of our User Agreement and
      Privacy Policy and
        Cookie Statement and Ars
        Technica Addendum and Your
        California Privacy Rights. Ars Technica may earn compensation on
      sales from links on this site. Read our
        affiliate link policy. The material on this site may not be
      reproduced, distributed, transmitted, cached or otherwise used, except
      with the prior written permission of Condé Nast. Ad
        Choices























research!rsc: Timeline of the xz open source attack








research!rsc
Thoughts and links about programming,
    by Russ Cox 
RSS



Timeline of the xz open source attack

        


            Posted on Monday, April 1, 2024.Updated Wednesday, April 3, 2024.


        



Over a period of over two years, an attacker using the name “Jia Tan”
worked as a diligent, effective contributor to the xz compression library,
eventually being granted commit access and maintainership.
Using that access, they installed a very subtle, carefully hidden backdoor into liblzma,
a part of xz that also happens to be a dependency of OpenSSH sshd
on Debian, Ubuntu, and Fedora, and other systemd-based Linux systems that patched sshd to link libsystemd.
(Note that this does not include systems like Arch Linux, Gentoo, and NixOS, which do not patch sshd.)
That backdoor watches for the attacker sending hidden commands at the start of an SSH session,
giving the attacker the ability to run an arbitrary command on the target system without logging in:
unauthenticated, targeted remote code execution.


The attack was publicly disclosed on March 29, 2024 and
appears to be the first serious known supply chain attack on widely used open source software.
It marks a watershed moment in open source supply chain security, for better or worse.


This post is a detailed timeline that I have constructed of the
social engineering aspect of the attack, which appears to date
back to late 2021.
(See also my analysis of the attack script.)


Corrections or additions welcome on Bluesky, Mastodon, or email.
Prologue

2005–2008: Lasse Collin, with help from others, designs the .xz file format using the LZMA compression algorithm, which compresses files to about 70% of what gzip did [1]. Over time this format becomes widely used for compressing tar files, Linux kernel images, and many other uses.
Jia Tan arrives on scene, with supporting cast

2021-10-29: Jia Tan sends first, innocuous patch to the xz-devel mailing list, adding “.editorconfig” file.


2021-11-29: Jia Tan sends second innocuous patch to the xz-devel mailing list, fixing an apparent reproducible build problem. More patches that seem (even in retrospect) to be fine follow.


2022-02-07: Lasse Collin merges first commit with “jiat0218@gmail.com” as author in git metadata (“liblzma: Add NULL checks to LZMA and LZMA2 properties encoders”).


2022-04-19: Jia Tan sends yet another innocuous patch to the xz-devel mailing list.


2022-04-22: “Jigar Kumar” sends first of a few emails complaining about Jia Tan’s patch not landing. (“Patches spend years on this mailing list. There is no reason to think anything is coming soon.”) At this point, Lasse Collin has already landed four of Jia Tan’s patches, marked by “Thanks to Jia Tan” in the commit message.


2022-05-19: “Dennis Ens” sends mail to xz-devel asking if XZ for Java is maintained.


2022-05-19: Lasse Collin replies apologizing for slowness and adds “Jia Tan has helped me off-list with XZ Utils and he might have a bigger role in the future at least with XZ Utils. It’s clear that my resources are too limited (thus the many emails waiting for replies) so something has to change in the long term.”


2022-05-27: Jigar Kumar sends pressure email to patch thread. “Over 1 month and no closer to being merged. Not a surprise.”


2022-06-07: Jigar Kumar sends pressure email to Java thread. “Progress will not happen until there is new maintainer. XZ for C has sparse commit log too. Dennis you are better off waiting until new maintainer happens or fork yourself. Submitting patches here has no purpose these days. The current maintainer lost interest or doesn’t care to maintain anymore. It is sad to see for a repo like this.”


2022-06-08: Lasse Collin pushes back. “I haven’t lost interest but my ability to care has been fairly limited mostly due to longterm mental health issues but also due to some other things. Recently I’ve worked off-list a bit with Jia Tan on XZ Utils and perhaps he will have a bigger role in the future, we’ll see. It’s also good to keep in mind that this is an unpaid hobby project.”


2022-06-10: Lasse Collin merges first commit with “Jia Tan” as author in git metadata (“Tests: Created tests for hardware functions”). Note also that there was one earlier commit on 2022-02-07 that had the full name set only to jiat75.


2022-06-14: Lasse Collin merges only commit with “jiat75@gmail.com” as author. This could have been a temporary git misconfiguration on Jia Tan’s side forgetting their fake email address.


2022-06-14: Jugar Kumar sends pressure email. “With your current rate, I very doubt to see 5.4.0 release this year. The only progress since april has been small changes to test code. You ignore the many  patches bit rotting away on this mailing list. Right now you choke your repo. Why wait until 5.4.0 to change maintainer? Why delay what your repo needs?”


2022-06-21: Dennis Ens sends pressure email. “I am sorry about your mental health issues, but its important to be aware of your own limits. I get that this is a hobby project for all contributors, but the community desires more. Why not pass on maintainership for XZ for C so you can give XZ for Java more attention? Or pass on XZ for Java to someone else to focus on XZ for C? Trying to maintain both means that neither are maintained well.”


2022-06-22: Jigar Kumar sends pressure email to C patch thread. “Is there any progress on this? Jia I see you have recent commits. Why can’t you commit this yourself?”


2022-06-29: Lasse Collin replies: “As I have hinted in earlier emails, Jia Tan may have a bigger role in the project in the future. He has been helping a lot off-list and is practically a co-maintainer already. :-) I know that not much has happened in the git repository yet but things happen in small steps. In any case some change in maintainership is already in progress at least for XZ Utils.”
Jia Tan becomes maintainer

At this point Lasse seems to have started working even more closely with Jia Tan. Brian Krebs observes that many of these email addresses never appeared elsewhere on the internet, even in data breaches (nor again in xz-devel). It seems likely that they were fakes created to push Lasse to give Jia more control. It worked. Over the next few months, Jia started replying to threads on xz-devel authoritatively about the upcoming 5.4.0 release.


2022-09-27: Jia Tan gives release summary for 5.4.0. (“The 5.4.0 release that will contain the multi threaded decoder is planned for December. The list of open issues related to 5..4.0 [sic] in general that I am tracking are...”)


2022-10-28: Jia Tan added to the Tukaani organization on GitHub. Being an organization member does not imply any special access, but it is a necessary step before granting maintainer access.


2022-11-30: Lasse Collin changes bug report email from his personal address to an alias that goes to him and Jia Tan, notes in README that “the project maintainers Lasse Collin and Jia Tan can be reached via xz@tukaani.org”.


2022-12-30: Jia Tan merges a batch of commits directly into the xz repo (“CMake: Update .gitignore for CMake artifacts from in source build”). At this point we know they have commit access. Interestingly, a few commits later in the same batch is the only commit with a different full name: “Jia Cheong Tan”.


2023-01-11: Lasse Collin tags and builds his final release, v5.4.1.


2023-03-18: Jia Tan tags and builds their first release, v5.4.2.


2023-03-20: Jia Tan updates Google oss-fuzz configuration to send bugs to them.


2023-06-22: Hans Jansen sends a pair of patches, merged by Lasse Collin, that use the “GNU indirect function” feature to select a fast CRC function at startup time. The final commit is reworked by Lasse Collin and merged by Jia Tan. This change is important because it provides a hook by which the backdoor code can modify the global function tables before they are remapped read-only. While this change could be an innocent performance optimization by itself, Hans Jansen returns in 2024 to promote the backdoored xz and otherwise does not exist on the internet.


2023-07-07: Jia Tan disables ifunc support during oss-fuzz builds, claiming ifunc is incompatible with address sanitizer. This may well be innocuous on its own, although it is also more groundwork for using ifunc later.


2024-01-19: Jia Tan moves web site to GitHub pages, giving them control over the XZ Utils web page. Lasse Collin presumably created the DNS records for the xz.tukaani.org subdomain that points to GitHub pages. After the attack was discovered, Lasse Collin deleted this DNS record to move back to tukaani.org, which he controls.
Attack begins

2024-02-23: Jia Tan merges hidden backdoor binary code well hidden inside some binary test input files. The README already said (from long before Jia Tan showed up) “This directory contains bunch of files to test handling of .xz, .lzma (LZMA_Alone), and .lz (lzip) files in decoder implementations. Many of the files have been created by hand with a hex editor, thus there is no better “source code” than the files themselves.” Having these kinds of test files is very common for this kind of library. Jia Tan took advantage of this to add a few files that wouldn’t be carefully reviewed.


2024-02-24: Jia Tan tags and builds v5.6.0 and publishes an xz-5.6.0.tar.gz distribution with an extra, malicious build-to-host.m4 that adds the backdoor when building a deb/rpm package. This m4 file is not present in the source repository, but many other legitimate ones are added during package as well, so it’s not suspicious by itself. But the script has been modified from the usual copy to add the backdoor. See my xz attack shell script walkthrough post for more.


2024-02-24: Gentoo starts seeing crashes in 5.6.0. This seems to be an actual ifunc bug, rather than a bug in the hidden backdoor, since this is the first xz with Hans Jansen’s ifunc changes, and Gentoo does not patch sshd to use libsystemd, so it doesn’t have the backdoor.


2024-02-26: Debian adds xz-utils 5.6.0-0.1 to unstable.


2024-02-27: Jia Tan starts emailing Richard W.M. Jones to update Fedora 40 (privately confirmed by Rich Jones).


2024-02-28: Debian adds xz-utils 5.6.0-0.2 to unstable.


2024-02-28: Jia Tan breaks landlock detection in configure script by adding a subtle typo in the C program used to check for landlock support. The configure script tries to build and run the C program to check for landlock support, but since the C program has a syntax error, it will never build and run, and the script will always decide there is no landlock support. Lasse Collin is listed as the committer; he may have missed the subtle typo, or the author may be forged. Probably the former, since Jia Tan did not bother to forge committer on his many other changes. This patch seems to be setting up for something besides the sshd change, since landlock support is part of the xz command and not liblzma. Exactly what is unclear.


2024-02-29: On GitHub, @teknoraver sends pull request to stop linking liblzma into libsystemd. It appears that this would have defeated the attack. Kevin Beaumont speculates that knowing this was on the way may have accelerated the attacker’s schedule. @teknoraver commented on HN that the liblzma PR was one in a series of dependency slimming changes for libsystemd; there were two mentions of it in late January.


2024-03-04: RedHat distributions start seeing Valgrind errors in liblzma’s _get_cpuid (the entry to the backdoor). The race is on to fix this before the Linux distributions dig too deeply.


2024-03-05: The libsystemd PR is merged to remove liblzma. Another race is on, to get liblzma backdoor’ed before the distros break the approach entirely.


2024-03-05: Debian adds xz-utils 5.6.0-0.2 to testing.


2024-03-05: Jia Tan commits two ifunc bug fixes. These seem to be real fixes for the actual ifunc bug. One commit links to the Gentoo bug and also typos an upstream GCC bug.


2024-03-08: Jia Tan commits purported Valgrind fix. This is a misdirection, but an effective one.


2024-03-09: Jia Tan commits updated backdoor files. This is the actual Valgrind fix, changing the two test files containing the attack code. “The original files were generated with random local to my machine. To better reproduce these files in the future, a constant seed was used to recreate these files.”


2024-03-09: Jia Tan tags and build v5.6.1 and publishes xz 5.6.1 distribution, containing a new backdoor. To date I have not seen any analysis of how the old and new backdoors differ.


2024-03-20: Lasse Collin sends LKML a patch set replacing his personal email with both himself and Jia Tan as maintainers of the xz compression code in the kernel. There is no indication that Lasse Collin was acting nefariously here, just cleaning up references to himself as sole maintainer. Of course, Jia Tan may have prompted this, and being able to send xz patches to the Linux kernel would have been a nice point of leverage for Jia Tan’s future work. We’re not at trusting trust levels yet, but it would be one step closer.


2024-03-25: Hans Jansen is back (!), filing a Debian bug to get xz-utils updated to 5.6.1. Like in the 2022 pressure campaign, more name###@mailhost addresses that don’t otherwise exist on the internet show up to advocate for it.


2024-03-27: Debian updates to 5.6.1.


2024-03-28: Jia Tan files an Ubuntu bug to get xz-utils updated to 5.6.1 from Debian.
Attack detected

2024-03-28: Andres Freund discovers bug, privately notifies Debian and distros@openwall. RedHat assigns CVE-2024-3094.


2024-03-28: Debian rolls back 5.6.1, introducing 5.6.1+really5.4.5-1.


2024-03-28: Arch Linux changes 5.6.1 to build from Git.


2024-03-29: Andres Freund posts backdoor warning to public oss-security@openwall list, saying he found it “over the last weeks”.


2024-03-29: RedHat announces that the backdoored xz shipped in Fedora Rawhide and Fedora Linux 40 beta.


2024-03-30: Debian shuts down builds to rebuild their build machines using Debian stable (in case the malware xz escaped their sandbox?).


2024-03-30: Haiku OS moves to GitHub source repo snapshots.
Further Reading


Evan Boehs, Everything I know about the XZ backdoor (2024-03-29).

Filippo Valsorda, Bluesky re backdoor operation (2024-03-30).

Michał Zalewski, Techies vs spies: the xz backdoor debate (2024-03-30).

Michał Zalewski, OSS backdoors: the folly of the easy fix (2024-03-31).

Connor Tumbleson, Watching xz unfold from afar (2024-03-31).

nugxperience, Twitter re awk and rc4 (2024-03-29)

birchb0y, Twitter re time of day of commit vs level of evil (2024-03-29)

Dan Feidt, ‘xz utils’ Software Backdoor Uncovered in Years-Long Hacking Plot (2024-03-30)

smx-smz, [WIP] XZ Backdoor Analysis and symbol mapping

Dan Goodin, What we know about the xz Utils backdoor that almost infected the world (2024-04-01)

Akamai Security Intelligence Group, XZ Utils Backdoor — Everything You Need to Know, and What You Can Do (2024-04-01)

Kevin Beaumont, Inside the failed attempt to backdoor SSH globally — that got caught by chance (2024-03-31)

amlweems, xzbot: notes, honeypot, and exploit demo for the xz backdoor (2024-04-01)

Rhea Karty and Simon Henniger, XZ Backdoor: Times, damned times, and scams (2024-03-30)

Andy Greenberg and Matt Burgess, The Mystery of ‘Jia Tan,’ the XZ Backdoor Mastermind (2024-04-03)

Risky Business #743 -- A chat about the xz backdoor with the guy who found it (2024-04-03)





























XZ Backdoor Attack CVE-2024-3094: All You Need To Know

































































































 









Products
Solutions
Pricing
Developers
Resources
Partners















                            Discover Our Partner Ecosystem                             > 






                            Find a JFrog Partner                             > 






                            Explore Partner Integrations                             > 

























                  Community                   > 






                  Documentation                   > 






                  Integrations                   > 






                  Applications                   > 






















              Use Case            



                      Cloud Solutions                                          
 

Flexible Cloud Deployment Solutions                              






                      AI/ML                                          
 

Model Lifecycle Management (MLOps)                              


Data Engineering & Feature Management (DataOps)                              


AI/ML Development and Deployment                              


MLSecOps                              






                      DevOps                                          
 

Artifact Management                              


Tool Consolidation                              


Release Lifecycle Management                              






                      DevSecOps                                          
 

Holistic Software Supply Chain Security                              


Curate Open-Source Packages                              


Source Code Scanning (SAST)                              


Software Composition Analysis (SCA)                               


Secrets Detection                              


Infrastructure as Code (IaC) Security                               






                      Device/IoT                                          
 

Connected Device Management                              








              Integrations            




GitHub  > 






NVIDIA  > 






                      Docker                                               > 






                      Maven                                               > 






                      See all integrations                                               > 







              Industry            




                      Financial Services                                               > 






                      Public Sector                                               > 






                      Technology                                               > 






                      Healthcare                                               > 






                      Gaming                                               > 






                      Automotive                                               > 






                      Enterprise                                               > 






















          Learning & Guides        




                  JFrog Help Center                   > 






                  Security Research                   > 






                  JFrog Academy                   > 






                  Events                   > 






                  Webinars & Workshops                   > 






                  DevOps Consulting Services                   > 






                  DevOps Certification                   > 






                  State of Union Report                   > 






                  Software Supply Chain Topics                   > 







          Collateral        




                  Resource Center                   > 






                  JFrog Blog                   > 






                  Customer Stories                   > 







          Customer Zone        




                  Support                   > 

Customer support, tickets and community





                  Manage & Troubleshoot                   > 

Renew, retrieve licenses, legal and more





                  MyJFrog                   > 

Cloud customer portal





                  Cloud Status                   > 

Service status & event subscription





                  JFrog Trust                   > 

How we protect you & your data




























                    The JFrog Platform                  
Deliver Trusted Software with SpeedThe only software supply chain platform to give you end-to-end visibility, security, and control for automating delivery of trusted releases. Bring together DevOps, DevSecOps and MLOps teams in a single source of truth.
View Platform
















                      DevOps                    









                                  JFrog Artifactory                                
Universal Artifact & ML Model Repository Manager










                                  JFrog Distribution                                
Secure Distribution Across Consumption Points










                                  JFrog Connect                                
IoT Device Management with DevOps Agility








                      DevSecOps                    









                                  JFrog Curation                                
Seamlessly Curate Software Packages & ML Models










                                  JFrog Security Essentials (Xray)                                
Integrated SCA for Software & AI Artifacts










                                  JFrog Advanced Security                                
Supply Chain Exposure Scanning & Impact Analysis










                                  JFrog Runtime                                
Real-time visibility into runtime vulnerabilities








                      AI/ML                    









                                  JFrog ML                                
Build, Train, Secure, Deploy, Serve and Monitor ML Models and GenAI























Contact UsStart Free













Products




The JFrog Platform

        Deliver Trusted Software with SpeedThe only software supply chain platform to give you end-to-end visibility, security, and control for automating delivery of trusted releases. Bring together DevOps, DevSecOps and MLOps teams in a single source of truth.      


          View Platform        




DevOps           






 JFrog Artifactory
Universal Artifact & ML Model Repository Manager
 






 JFrog Distribution
Secure Distribution Across Consumption Points
 






 JFrog Connect
IoT Device Management with DevOps Agility
 




DevSecOps           






 JFrog Curation
Seamlessly Curate Software Packages & ML Models
 






 JFrog Security Essentials (Xray)
Integrated SCA for Software & AI Artifacts
 






 JFrog Advanced Security
Supply Chain Exposure Scanning & Impact Analysis
 






 JFrog Runtime
Real-time visibility into runtime vulnerabilities
 




AI/ML           






 JFrog ML
Build, Train, Secure, Deploy, Serve and Monitor ML Models and GenAI
 








Solutions





Use Case                            



Cloud Solutions




                      Flexible Cloud Deployment Solutions                       





AI/ML




                      Model Lifecycle Management (MLOps)                       



                      Data Engineering & Feature Management (DataOps)                       



                      AI/ML Development and Deployment                       



                      MLSecOps                       





DevOps




                      Artifact Management                       



                      Tool Consolidation                       



                      Release Lifecycle Management                       





DevSecOps




                      Holistic Software Supply Chain Security                       



                      Curate Open-Source Packages                       



                      Source Code Scanning (SAST)                       



                      Software Composition Analysis (SCA)                        



                      Secrets Detection                       



                      Infrastructure as Code (IaC) Security                        





Device/IoT




                      Connected Device Management                       






Integrations                            



GitHub




NVIDIA




Docker




Maven




See all integrations





Industry                            



Financial Services




Public Sector




Technology




Healthcare




Gaming




Automotive




Enterprise













Pricing




Developers








Community




Documentation




Integrations




Applications













Resources





Learning & Guides                            



JFrog Help Center




Security Research




JFrog Academy




Events




Webinars & Workshops




DevOps Consulting Services




DevOps Certification




State of Union Report




Software Supply Chain Topics





Collateral                            



Resource Center




JFrog Blog




Customer Stories





Customer Zone                            



Support
Customer support, tickets and community




Manage & Troubleshoot
Renew, retrieve licenses, legal and more




MyJFrog
Cloud customer portal




Cloud Status
Service status & event subscription




JFrog Trust
How we protect you & your data













Partners








Discover Our Partner Ecosystem




Find a JFrog Partner




Explore Partner Integrations
























Blog Home



CVE-2024-3094 XZ Backdoor: All you need to know




 

        By
        
              
Shachar Menashe,  JFrog VP Security Research


Jonathan Sar Shalom,  JFrog Director of Threat Research


Brian Moussalli,  JFrog Malware Research Team Leader

March 31, 2024




  14 min read 





SHARE:

























Update April 1st – Updated “What is the malicious payload of CVE-2024-3094?” due to newly released OSS tools
Update April 7th – Updated “What is the malicious payload of CVE-2024-3094?” due to more published payload research
 
On March 29th, it was reported that malicious code enabling unauthorized remote SSH access has been detected within XZ Utils, a widely used package present in major Linux distributions (The GitHub project originally hosted here is now suspended). Fortunately, the malicious code was discovered quickly by the OSS community and managed to infect only two of the most recent versions of the package, 5.6.0 and 5.6.1, which were released within the past month. Stable versions of most Linux distributions were not affected.
The sophisticated malicious payload that came with the affected versions of XZ Utils ran in the same process as the OpenSSH server (SSHD) and modified decryption routines in the OpenSSH server in order to allow specific remote attackers (that own a specific private key) to send arbitrary payloads through SSH which will be executed before the authentication step, effectively hijacking the entire victim machine.
This supply chain attack came as a shock to the OSS community, as XZ Utils was considered a trusted and scrutinized project. The attacker built up a credible reputation as an OSS developer over the span of multiple years and used highly obfuscated code in order to evade detection by code reviews. Following our initial research communication, this post will detail its fundamentals and impact.

Who is affected by CVE-2024-3094?
How to detect CVE-2024-3094
How to remediate CVE-2024-3094
JFrog OSS tools for detection of CVE-2024-3094
CVE-2024-3094 technical analysis
Is the JFrog Platform affected by CVE-2024-3094?
Is Conan affected by CVE-2024-3094?
Detecting and resolving CVE-2024-3094 with JFrog Xray

Who is affected by CVE-2024-3094?
The following distributions were affected by the attack –



Distribution
Affected Branches
Affected Packages
Remediation
Comments


Fedora
40, 41, Rawhide (active development)
xz-5.6.0-*
xz-5.6.1-*
Fedora 40 – Update to latest version (5.4.x).
Fedora 41 & Rawhide – Stop using immediately.



Debian
testing, unstable (sid), experimental
xz-utils 5.5.1alpha-0.1
(uploaded on 2024-02-01), up to and including 5.6.1-1
Update to latest version (5.6.1+really5.4.5-1)
No stable branches are affected


Alpine
Edge (active development)
xz 5.6.1-r0, 5.6.1-r1
Update to latest version (5.6.1-r2)
No stable branches are affected


Kali
N/A
xz-utils 5.6.0-0.2
(Kali installations updated between March 26th to March 29th)
Update to latest version (5.6.1+really5.4.5-1)



OpenSUSE
Tumbleweed
xz-5.6.0, xz-5.6.1
Update to latest version (5.6.1.revertto5.4)



Arch Linux
N/A
xz 5.6.0-1
Update to latest version (5.6.1-2)




 
The following distributions were not affected –
 



Distribution
Affected Branches
Affected Packages
Remediation
Comments


Red Hat Enterprise Linux
N/A
N/A
N/A
No versions of Red Hat Enterprise Linux (RHEL) are affected.


Ubuntu
N/A
N/A
N/A
The affected version of xz-utils was only in noble-proposed, and
was removed before migrating to noble itself.


Amazon Linux
N/A
N/A
N/A



Wolfi
N/A
N/A
N/A
The affected version of liblzma was briefly available (now reverted) but Wolfi’s OpenSSH does not link to liblzma, making it unaffected.


Gentoo
N/A
xz-utils 5.6.0, xz-utils 5.6.1
Update to latest version (restores 5.4.2)
Although Gentoo pulled the vulnerable version, it isn’t affected since its OpenSSH isn’t patched to work with systemd-notify, which is a prerequisite for the backdoor.



How to detect CVE-2024-3094
Check if your version of “xz” is one of the affected versions (5.6.0 or 5.6.1, see table above) by running –
strings `which xz` | grep '5\.6\.[01]'

Example of a vulnerable output –
$ strings `which xz` | grep '5\.6\.[01]'
xz (XZ Utils) 5.6.1
Example of a safe output –
$ strings `which xz` | grep '5\.6\.[01]'
Note that in Alpine Linux (edge branch), the output of xz --version  is “5.6.1” even on the fixed version (5.6.1-r2) –

It is possible to validate the exact version using the Alpine Package Manager –
$ apk list xz
xz-5.6.1-r2 x86_64 {xz} ...
How to remediate CVE-2024-3094
Immediately downgrade your version of xz to an earlier version (5.4.6 is the latest unaffected version in most distributions).
After downgrading xz, either reboot your machine or restart the OpenSSH server in order to remove the patched code from memory –
sudo systemctl restart ssh
If upgrading is not possible, another possible workaround is to take advantage of the backdoor’s “kill switch”. Adding the following string to /etc/environment will disable the malicious backdoor functionality (applies after restarting SSH and Systemd) –
yolAbejyiejuvnup=Evjtgvsh5okmkAvj
JFrog OSS tools for detection of CVE-2024-3094
The JFrog Research team published an open-source detector for CVE-2024-3094.
The tool checks whether the local machine is both vulnerable to CVE-2024-3094 (SSH payload is able to run) and currently affected by CVE-2024-3094 (malicious version of XZ is currently installed).

Update April 2nd –

We fixed several reported issues with the tool on Github.
Added contributed code to detect the malicious versions in Arch Linux.
Added another detection method of malicious liblzma by looking for encrypted strings the malware decrypts and uses in runtime, such as yolAbejyiejuvnup=Evjtgvsh5okmkAvj and Shutdown. On most of the malicious liblzma versions we have analyzed, these strings can be found in the .rodata section.

CVE-2024-3094 technical analysis
What is the malicious payload of CVE-2024-3094?
TL;DR – the end goal of the malicious backdoor introduced by CVE-2024-3094, is to inject code to the OpenSSH server (SSHD) that runs on the victim machine, and allow specific remote attackers (that own a specific private key) to either –
1. Send arbitrary payloads through SSH which will be executed before the authentication step
OR
2. Bypass SSH password-based authentication (attacker can login with any password)
Both of these abilities effectively hijack the entire victim machine.
The backdoor payload is still under analysis, but based on preliminary analysis, initial open-source tools and technical tweets it seems that the payload is highly sophisticated –

The payload gets injected into OpenSSH server (sshd process), since liblzma (that contains the malicious code) is a dependency of certain builds of OpenSSH.
The payload hooks the RSA_public_decrypt function, a function originally used for validating RSA signatures.
The malicious hook code examines the RSA public modulus (“N” value) passed inside the RSA struct (4th argument of RSA_public_decrypt). Note that this modulus is completely controlled by the connecting SSH client (in our case, the attackers).
The malicious hook code examines the first 16 bytes of the “N” value, which are used in a simple calculation to derive a “Command Number” between 0 and 3. The command number sets the backdoor’s current operation –
– Command 0x00 – Unknown
– Command 0x01 – SSH authentication bypass
– Command 0x02 – Execute shell command
– Command 0x03 – Execute shell command with specified UID/GID
The malicious hook code then decrypts the last 240 bytes of the “N” value using the ChaCha20 symmetric stream cipher, with a hardcoded decryption key –
0a 31 fd 3b 2f 1f c6 92 92 68 32 52 c8 c1 ac 28
34 d1 f2 c9 75 c4 76 5e b1 f6 88 58 88 93 3e 48
Since this is a symmetric, hardcoded key it can be used to decrypt network captures of real-world attack attempts to understand which commands were sent from the attacker to the victim.
The decrypted data contains 114 bytes of signature which are checked for validity by using the Ed448 asymmetric elliptic curve signing algorithm, specifically using the following Ed448 public key –
0a 31 fd 3b 2f 1f c6 92 92 68 32 52 c8 c1 ac 28
34 d1 f2 c9 75 c4 76 5e b1 f6 88 58 88 93 3e 48
10 0c b0 6c 3a be 14 ee 89 55 d2 45 00 c7 7f 6e
20 d3 2c 60 2b 2c 6d 31 00While the public key is well-known, only the attackers have the corresponding Ed448 private signing key, ensuring that only the attackers can generate valid payloads for the backdoor. Furthermore, the signature is bound to the host’s public key, meaning that a valid signature for one host cannot be reused on a different host.
If the signature was verified as valid, the backdoor uses the bytes directly following the signature bytes as command-specific payload data. For example in command 0x02, the payload bytes contain A NULL-terminated shell command string (ex. cat /etc/shadow), that is directly passed to system()
If the data is invalid in any way (malformed payload, invalid signature), the original implementation of RSA_public_decrypt is resumed in a transparent manner. This means the detection of vulnerable machines over the network may be impossible for anyone besides the attackers.

The sophisticated nature of this attack and the use of highly future proof crypto algorithms (Ed448 vs the more standard Ed25519) led many to believe that the attack may be a nation-state level cyberattack.
Researchers have published an initial backdoor client that allows sending payloads (shell commands) to machines affected with CVE-2024-3094, given the backdoor’s Ed448 private signing key. Since the original Ed448 private signing key is not publicly known, this tool is mostly relevant for research purposes (to be used against patched versions of the backdoor, where the Ed448 public key has been replaced by a keypair with a known private key)
Timeline of the attack
The most notable part of this supply chain attack is the extreme levels of dedication of the attacker, working more than two years to establish themselves as a legitimate maintainer, offering to pick up work in various OSS projects and committing code across multiple projects in order to avoid detection.
2021 – GitHub user Jia Tan (JiaT75) account created. Started contributing to several projects with 546 commits done in 2021, of which the most suspicious one was made to libarchive. A more detailed account of this commit can be found below.
2022, February 6th – JiaT75 submits a first (legitimate) commit to the XZ repo. The commit adds arguments validation to the LZMA and LZMA2 encoders.
Add Parameter Validation to LZMA and LZMA2 encoders
2022, November 30th – Lasse Collins, XZ Utils’ creator and sole maintainer so far, changes the bug reporting email to an alias that redirects emails to him and Jia Tan.
2023, January 11th – Lasse Collins releases his final version, 5.4.1.
2023, March 18th – Jia Tan builds and releases their first release, 5.4.2.
2023, June 27-28th – A series of changes were made to XZ Utils, possibly setting the ground for the attack. In these changes, support for ifunc implementation to crc64_fast.c, was added.
Introducing the ifunc implementation to XZ Utils
Interestingly, this patch was introduced by the original maintainer of the package, Lasse Collin, who credited another contributor for this patch, Hans Jansen. This ifunc implementation is possibly one of the ways which the backdoor seems to operate, according to the analysis by Andres Freund.
2023, July 8th – JiaT75 opens a Pull Request in oss-fuzz, a project that performs fuzz testing on XZ and many other OSS projects. The PR disables ifunc fuzzing, which effectively prevents oss-fuzz from finding the malicious changes done in XZ.
2024, February 15th – JiaT75 adds an ignore rule for build-to-host.m4 in the XZ repository, via its .gitignore file. This script file, soon to be included in actual release bundles, is executed during the package’s build, and contains the malicious M4 macros which initializes the backdoor’s installation on the victim’s machine.
2024, February 23rd – JiaT75 adds the obfuscated binary backdoor in two tests files in the XZ repository –

tests/files/bad-3-corrupt_lzma2.xz
tests/files/good-large_compressed.lzma

2024, February 24th – JiaT75 releases version 5.6.0 with the malicious build-to-host.m4. At this stage, the malicious payload is fully operational (any subsequent XZ version is compromised). Malicious xz-utils version 5.6.0 pulled by Debian, Gentoo and Arch Linux.
2024, February 27th – Malicious xz-utils version 5.6.0 pulled by Fedora.
2024, March 5th – Malicious xz-utils version 5.6.0 pulled by openSUSE.
2024, March 9th – JiaT75 updates the backdoor’s binaries to an improved version, and releases version 5.6.1. Malicious xz-utils version 5.6.1 pulled by Fedora, Gentoo and Arch Linux
2024, March 10th – Malicious xz-utils version 5.6.1 pulled by openSUSE.
2024, March 11th – Malicious xz-utils version 5.6.1 pulled by Alpine.
2024, March 26th – Malicious xz-utils version 5.6.1 pulled by Debian.
2024, March 29th – A detailed account of the malicious activity found in XZ utils was published on the oss-security mailing list by Andres Freund.
2024, March 30th – Lasse Collins, xz-utils original maintainer, made an official announcement regarding the project’s breach.
* Some additions we made to this timeline were based on Russ Cox’s research.
Was only XZ affected by the malicious actor?
While the malicious code was detected only on the XZ project, other code contributions of the attacker’s account are currently being investigated. As for today, some notable suspicious code was added to the following projects:
libarchive:
In 2021, JiaT75 submitted a pull request to the libarchive repository with the title ‘Added error text to warning when untaring with bsdtar’ which seemed legitimate at first glance. However, upon closer inspection, it was discovered that the code in this pull request replaced the safe function safe_fprintf() with the unsafe version fprintf(), potentially introducing a character escape vulnerability. The security implications of this change are currently being investigated, as they are not yet clear. However, since a malicious actor is involved in this code modification, it is reasonable to assume that more sophisticated attacks might be at play in this investigation. A PoC for characters escape was already published:
PoC by mikesiegel
A fix to this vulnerability was introduced to libarchive main branch but has not yet been released as a version update at the time of writing.
oss-fuzz:
In early 2023, JiaT75 changed the primary email address of the XZ project in Google’s oss-fuzz tool to his own personal Gmail address. This suggests that they may have wanted reports of vulnerabilities found in Project XZ to be reported to them first so that they would know when their malicious actions are discovered –

Later in 2023, they opened another PR to disable `Indirect function support` in the fuzzer’s configuration for the XZ project. This looks like preparation for the backdoor they were going to add later to the XZ project to prevent detection by the fuzzer –

Currently, both the fuzzers for XZ and liblzma were disabled by the oss-fuzz maintainers.
Is the JFrog Platform affected by CVE-2024-3094?
JFrog is not affected by CVE-2024-3094 as none of its products use the vulnerable xz_utils versions.
Is Conan affected by CVE-2024-3094?
As of March 30th, recipes containing the vulnerable xz_utils versions have been removed from Conan Center.
In addition, recipes that depended on the affected versions of xz_utils (cpython and libunwind) have been reverted to require the latest safe version of xz_utils.
Detecting and resolving CVE-2024-3094 with JFrog Xray
JFrog Security Essentials (Xray) can be used to identify every vulnerable occurrence across your entire codebase and compiled artifacts, including Docker containers, repository packages, and even standalone binaries.
JFrog Xray can be used to scan binary artifacts in order to detect the affected libraries –


Schedule a demo of JFrog Security Solutions!


    Book a Demo
    


Stay up-to-date with JFrog Security Research
The security research team’s findings and research play an important role in improving the JFrog Software Supply Chain Platform’s application software security capabilities.
Follow the latest discoveries and technical updates from the JFrog Security Research team on our research website, and on X @JFrogSecurity.



 Tags:

								xz-backdoor                            

								security-research                            




				Start a Trial            



SHARE:




























Sign up for blog updates






I agree that JFrog may use my information in accordance with the JFrog Privacy Notice




      Subscribe    














Popular Tags



						CI/CD					



						Artifactory					



						Best Practices					



						DevOps					



						Xray					




See what JFrog & GitHub can do together





Learn More











Thank You!






Full Name*



Email*









I have read and agree to the Privacy Policy





      Proceed    



















 




ProductsArtifactory
Xray
Curation
Distribution
Container Registry
Connect
JFrog ML
JFrog Platform
Start Free
 

ResourcesBlog
Security Research
Events
Integrations
JFrog Help Center
Software Supply Chain Topics
Open Source
JFrog Trust
Compare JFrog
 

CompanyAbout
Management
Investor Relations
Partners
Customers
Careers
Press
Contact Us
Brand Guidelines
 

DeveloperCommunity
Downloads
Community Events
Community Forum
Applications
 





 Follow Us 




 



 





 



 





               © 2025 JFrog Ltd All Rights Reserved            



Discover MoreWelcome to the  BlogWhat is a Software Supply Chain?Data Scientists Targeted by Malicious Hugging Face ML Models with Silent Backdoor 








 


        Terms of Use      
| 
        Privacy Notice      
| 
        Cookies Policy      
|


  Cookies Settings


|

      Accessibility Notice    
|
Accessibility Mode




















                            Thank You!                        


Your submission has been recieved.
We will contact you soon!



                            OK                        












                      x
                    










Oops...                        Something went wrong


Please try again later


Continue
















                            Information                        



Modal Message


Continue




















                        Click Here                      









                        请点这里                      




















 




